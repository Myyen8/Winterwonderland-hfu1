<!DOCTYPE html>
<html>

<head>
    <title>Simple AR - A Web based AR for A-Frame</title>
    <script src="js/aframe-v1.5.0.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@1.0.0/dist/aframe-look-at-component.min.js"></script>
</head>

<body>
    <script src="js/simple-ar.min.js" onload="onWasmLoaded();"></script>
    <a-scene>
        <a-entity simple-ar="src: assets/schneemann.jpeg; minCutOffValue: 1; betaValue:0.1;">
            <a-entity id="snow"></a-entity>
            <a-sound src="assets/background_music.mp3" autoplay="true" loop="true" volume="0.5"></a-sound>
        </a-entity>
        <a-camera position="0 0 0"></a-camera>
    </a-scene>

    
    <script>
        const targetObject = document.querySelector('#snow');
        // Skalierungsfaktor f√ºr die gesamte Szene, falls n√∂tig, um die Responsivit√§t anzupassen.
        // const scaleFactor = 1; 

        // üå®Ô∏è SCHNEEFLOCKEN üå®Ô∏è
        for (let i = 0; i < 100; i++) {
            const plane = document.createElement('a-plane');
            const size = (Math.random() * 0.3 + 0.01).toFixed(2); // Gr√∂√üe reduziert
            const bounds = 3; // Begrenzung des Schneefallbereichs
            const startY = Math.random() * 4 + 1;
            const endY = -5;

            const startX = (Math.random() - 0.5) * bounds;
            const startZ = (Math.random() - 0.5) * bounds;

            plane.setAttribute('width', size);
            plane.setAttribute('height', size);
            plane.setAttribute('position', `${startX} ${startY} ${startZ}`);
            plane.setAttribute('material', {
                src: 'assets/schneeflocken.png',
                alphaTest: 0.5,
                transparent: true // F√ºgt Transparenz hinzu
            });

            // WICHTIG: Stelle sicher, dass die Schneeflocke immer zur Kamera zeigt, 
            // damit sie nicht nur als d√ºnne Linie erscheint, wenn sie gedreht wird.
            plane.setAttribute('look-at-camera', ''); 

            const duration = 4000 + Math.random() * 3000;

            plane.setAttribute('animation__fall', {
                property: 'position',
                from: `${startX} ${startY} ${startZ}`,
                to: `${startX} ${endY} ${startZ}`,
                dur: duration,
                easing: 'linear',
                loop: true
            });

            plane.addEventListener('animationloop', () => {
                const newX = (Math.random() - 0.5) * bounds;
                const newY = Math.random() * 4 + 1;
                const newZ = (Math.random() - 0.5) * bounds;

                plane.setAttribute('animation__fall', {
                    from: `${newX} ${newY} ${newZ}`,
                    to: `${newX} ${endY} ${newZ}`,
                    dur: 4000 + Math.random() * 3000
                });
            });

            targetObject.appendChild(plane);
        }

        // üéÑ TANNENB√ÑUME üéÑ
        const treeCount = 20; // Reduzierte Anzahl f√ºr Performance
        const areaBounds = 5; // Die B√§ume werden in einem quadratischen Bereich platziert
        const treeSizeX = 1;
        const treeSizeY = 2;
        const treePosY = -1.0; // Die B√§ume sitzen auf dem Schneeboden (-1.0)

        for (let i = 0; i < treeCount; i++) {
            const tree = document.createElement('a-plane');

            const posX = (Math.random() - 0.5) * areaBounds * 2;
            const posZ = (Math.random() - 0.5) * areaBounds * 2;

            const randomScale = Math.random() * 0.4 + 0.8;
            tree.setAttribute('width', treeSizeX * randomScale);
            tree.setAttribute('height', treeSizeY * randomScale);

            tree.setAttribute('position', `${posX.toFixed(2)} ${treePosY} ${posZ.toFixed(2)}`);

            // WICHTIG: Stellt sicher, dass die B√§ume immer zur Kamera zeigen
            tree.setAttribute('look-at-camera', ''); 

            tree.setAttribute('material', {
                src: 'assets/tannenbaum.png',
                alphaTest: 0.5,
                transparent: true
            });

            targetObject.appendChild(tree);
        }

        // ‚ùÑÔ∏è SCHNEEBODEN ‚ùÑÔ∏è
        const snowGround = document.createElement('a-plane');
        const groundSize = 10; // Reduzierte Bodengr√∂√üe, um n√§her an der AR-Markierung zu sein

        snowGround.setAttribute('width', groundSize);
        snowGround.setAttribute('height', groundSize);
        snowGround.setAttribute('rotation', '-90 0 0'); 
        snowGround.setAttribute('position', `0 ${treePosY} 0`); // Position angepasst, damit B√§ume darauf stehen

        snowGround.setAttribute('material', {
            src: 'assets/snowground.png',
            repeat: '5 5', // Repeat angepasst
            transparent: true,
            alphaTest: 0.1, 
        });

        targetObject.appendChild(snowGround); 
    </script>
</body>

</html>