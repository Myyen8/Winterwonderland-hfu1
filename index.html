<!DOCTYPE html>
<html>

<head>
    <title>Simple AR - A Web based AR for A-Frame</title>
    <script src="js/aframe-v1.5.0.min.js"></script>
</head>

<body>
    <script src="js/simple-ar.min.js" onload="onWasmLoaded();"></script>
    <a-scene>
        <a-entity simple-ar="src: assets/schneemann.jpeg; minCutOffValue: 1; betaValue:0.1;">
            <a-entity id="snow"></a-entity>
           <a-sound src="assets/background_music.mp3" autoplay="true" loop="true" volume="0.5"></a-sound>
        </a-entity>
        <a-camera position="0 0 0"></a-camera>
    </a-scene>

    
    <script>

        const targetObject = document.querySelector('#snow');

        for (let i = 0; i < 100; i++) {
            const plane = document.createElement('a-plane');
            const size = (Math.random() * 0.7 + 0.02).toFixed(2);

            const startX = (Math.random() - 0.5) * 8;
            const startY = Math.random() * 6 + 2;
            const startZ = (Math.random() - 0.5) * 8;

            const endY = -10;

            plane.setAttribute('width', size);
            plane.setAttribute('height', size);
            plane.setAttribute('position', `${startX} ${startY} ${startZ}`);
            plane.setAttribute('material', {
                src: 'assets/schneeflocken.png',
                alphaTest: 0.5
            });

            const duration = 4000 + Math.random() * 3000;

            plane.setAttribute('animation__fall', {
                property: 'position',
                from: `${startX} ${startY} ${startZ}`,
                to: `${startX} ${endY} ${startZ}`,
                dur: duration,
                easing: 'linear',
                loop: true
            });

            plane.addEventListener('animationloop', () => {
                const newX = (Math.random() - 0.5) * 8;
                const newY = Math.random() * 6 + 2;
                const newZ = (Math.random() - 0.5) * 8;

                plane.setAttribute('animation__fall', {
                    from: `${newX} ${newY} ${newZ}`,
                    to: `${newX} ${endY} ${newZ}`,
                    dur: 4000 + Math.random() * 3000
                });
            });

            targetObject.appendChild(plane);
        }

const treeCount = 25;
        const radius = 4; // Abstand vom Zentrum
        
        for (let i = 0; i < treeCount; i++) {
            const tree = document.createElement('a-plane');

            // Berechnung des gleichmäßigen Winkels in Radian
            const angle = (i / treeCount) * 2 * Math.PI; 

            // Symmetrische Position (Kreis-Formel)
            const posX = radius * Math.cos(angle);
            const posZ = radius * Math.sin(angle);
            const posY = -1.2; // Bodenhöhe der Bäume
            
            const sizeX = 1.5;
            const sizeY = 2.5;

            // Optionale, leichte Größenvariation
            const randomScale = Math.random() * 0.4 + 0.8; 
            tree.setAttribute('width', sizeX * randomScale);
            tree.setAttribute('height', sizeY * randomScale);


            // Setze Position mit 2 Dezimalstellen für Sauberkeit
            tree.setAttribute('position', `${posX.toFixed(2)} ${posY} ${posZ.toFixed(2)}`);
            tree.setAttribute('look-at-camera', ''); // Ausrichtung auf Kamera

            tree.setAttribute('material', {
                src: 'assets/tannenbaum.png',
                alphaTest: 0.5,
                transparent: true
            });
        }
        
for (let i = 0; i < treeCount; i++) {
    const tree = document.createElement('a-plane');

    const sizeX = 1.5;
    const sizeY = 2.5;

    const posX = (Math.random() - 0.5) * 10;
    const posZ = (Math.random() - 0.5) * 10;
    const posY = -1.2;

    tree.setAttribute('width', sizeX);
    tree.setAttribute('height', sizeY);
    tree.setAttribute('position', `${posX} ${posY} ${posZ}`);
    tree.setAttribute('material', {
        src: 'assets/tannenbaum.png',
        alphaTest: 0.5,
        transparent: true
    });

    targetObject.appendChild(tree);
}
        
/// --- HIER WIRD DER SCHNEEBODEN HINZUGEFÜGT ---
        const snowGround = document.createElement('a-plane');

        snowGround.setAttribute('width', 20);
        snowGround.setAttribute('height', 20);
        snowGround.setAttribute('rotation', '-90 0 0'); 
        snowGround.setAttribute('position', '0 -2.5 0'); 

        snowGround.setAttribute('material', {
            src: 'assets/snowground.png',
            repeat: '10 10', 
            transparent: true,
            alphaTest: 0.1, 
        });

        targetObject.appendChild(snowGround); 
        // --- ENDE DES NEUEN CODES ---

    </script>
</body>

</html>